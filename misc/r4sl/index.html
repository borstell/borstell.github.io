<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carl “Calle” Börstell">
<meta name="dcterms.date" content="2023-08-17">

<title>R for Sign Language Linguistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R_for_SL_Linguistics_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_for_SL_Linguistics_files/libs/quarto-html/quarto.js"></script>
<script src="R_for_SL_Linguistics_files/libs/quarto-html/popper.min.js"></script>
<script src="R_for_SL_Linguistics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_for_SL_Linguistics_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_for_SL_Linguistics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_for_SL_Linguistics_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="R_for_SL_Linguistics_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="R_for_SL_Linguistics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_for_SL_Linguistics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_for_SL_Linguistics_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="R_for_SL_Linguistics_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#working-with-elan-files-.eaf" id="toc-working-with-elan-files-.eaf" class="nav-link" data-scroll-target="#working-with-elan-files-.eaf">Working with ELAN files (<code>.eaf</code>)</a>
  <ul class="collapse">
  <li><a href="#reading-elan-files-.eaf" id="toc-reading-elan-files-.eaf" class="nav-link" data-scroll-target="#reading-elan-files-.eaf">Reading ELAN files (<code>.eaf</code>)</a></li>
  <li><a href="#combining-elan-tiers-in-wide-format" id="toc-combining-elan-tiers-in-wide-format" class="nav-link" data-scroll-target="#combining-elan-tiers-in-wide-format">Combining ELAN tiers in wide format</a></li>
  <li><a href="#segmenting-turn-taking-in-elan-files" id="toc-segmenting-turn-taking-in-elan-files" class="nav-link" data-scroll-target="#segmenting-turn-taking-in-elan-files">Segmenting “turn-taking” in ELAN files</a></li>
  <li><a href="#splitting-videos-based-on-elan-annotation" id="toc-splitting-videos-based-on-elan-annotation" class="nav-link" data-scroll-target="#splitting-videos-based-on-elan-annotation">Splitting videos based on ELAN annotation</a></li>
  <li><a href="#further-possibilities" id="toc-further-possibilities" class="nav-link" data-scroll-target="#further-possibilities">Further possibilities</a></li>
  </ul></li>
  <li><a href="#plotting-handshape-fonts" id="toc-plotting-handshape-fonts" class="nav-link" data-scroll-target="#plotting-handshape-fonts">Plotting handshape fonts</a></li>
  <li><a href="#working-with-imagevideo-data" id="toc-working-with-imagevideo-data" class="nav-link" data-scroll-target="#working-with-imagevideo-data">Working with image/video data</a></li>
  <li><a href="#license" id="toc-license" class="nav-link" data-scroll-target="#license">License</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R for Sign Language Linguistics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Carl “Calle” Börstell </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 17, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This is a short tutorial intended to give some helpful pointers to those working on sign language data and the programming language R. The content here does not provide a general introduction to R. For such an introduction, I suggest looking at the free, online book <a href="http://r4ds.hadley.nz"><em>R for Data Science</em> (Wickham, Çetinkaya-Rundel &amp; Grolemund)</a>. I also recommend two books specifically targeting R for linguist(ic)s: <a href="https://benjamins.com/catalog/z.195">Levshina’s (2015) <em>How to do Linguistics with R</em></a> and <a href="https://www.routledge.com/Statistics-for-Linguists-An-Introduction-Using-R/Winter/p/book/9781138056091">Winter’s (2020) <em>Statistics for Linguists: An Introduction Using R</em></a>.</p>
<p>The code here also assumes the use of the <a href="https://www.tidyverse.org">{<code>tidyverse</code>}</a> libraries, for easy reading, writing and piping of data.</p>
</section>
<section id="working-with-elan-files-.eaf" class="level1">
<h1>Working with ELAN files (<code>.eaf</code>)</h1>
<p>Many (or most) sign language linguists work with <a href="https://archive.mpi.nl/tla/elan">ELAN</a> at some point. It is fantastic for annotating multimodal language data, and there is huge potential in the functionality in ELAN itself. Nonetheless, sometimes it is nice to be able to work with ELAN files (<code>.eaf</code> format) directly from R. With the <a href="https://github.com/borstell/signglossR/"><code>{signglossR}</code></a> package, I wrote a function called <code>read_elan()</code> for reading ELAN files directly from and into R, outputting a data frame for data analysis in R. However, I have also made this function available as a standalone function in a Github repo(sitory), there called <code>read_eaf()</code>. The functionality is the same, and you can direct the function to the path of either a single <code>.eaf</code> file or a whole directory (i.e.&nbsp;<em>folder</em>) containing multiple <code>.eaf</code> files which will be bound together into one data frame.</p>
<section id="reading-elan-files-.eaf" class="level2">
<h2 class="anchored" data-anchor-id="reading-elan-files-.eaf">Reading ELAN files (<code>.eaf</code>)</h2>
<p>In order to read ELAN files, you could either use use the <code>read_elan()</code> function from the <a href="https://github.com/borstell/signglossR/"><code>{signglossR}</code></a> package, or source the individual function <code>read_eaf()</code> into your current work session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below reads the function into the current session, for you to use</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/read_eaf.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can then either read a single EAF file: </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_eaf</span>(<span class="st">"/path/to/annotated_elan_file.eaf"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or point it to a directory (folder) containing multiple EAF files</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_eaf</span>(<span class="st">"/path/to/annotated_elan_files/"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to store this in a variable, if you want to work on it</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>my_elan_df <span class="ot">&lt;-</span> <span class="fu">read_eaf</span>(<span class="st">"/path/to/annotated_elan_files/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of these read functions should look something like this, a data frame (techically a <a href="https://tibble.tidyverse.org"><em>tibble</em></a>) with the annotation data organized in rows and columns:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-3_a1f163bff3e498450ba87e9acba9d7ea">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,682 × 14
   file     a     t1     t2     annotation tier  tier_type participant annotator
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;lgl&gt;    
 1 file_001 a1322 ts579  ts582  GLOSS-0864 glos… gloss_LH  Signer_001  NA       
 2 file_001 a1323 ts585  ts609  GLOSS-0521 glos… gloss_LH  Signer_001  NA       
 3 file_001 a1324 ts669  ts677  GLOSS-0521 glos… gloss_LH  Signer_001  NA       
 4 file_001 a1325 ts681  ts707  GLOSS-0864 glos… gloss_LH  Signer_001  NA       
 5 file_001 a1327 ts741  ts744  GLOSS-1657 glos… gloss_LH  Signer_001  NA       
 6 file_001 a1329 ts1488 ts1496 GLOSS-1656 glos… gloss_LH  Signer_001  NA       
 7 file_001 a1330 ts1567 ts1570 GLOSS-1422 glos… gloss_LH  Signer_001  NA       
 8 file_001 a1333 ts2687 ts2697 GLOSS-0865 glos… gloss_LH  Signer_001  NA       
 9 file_001 a1335 ts3168 ts3170 GLOSS-1046 glos… gloss_LH  Signer_001  NA       
10 file_001 a1336 ts3175 ts3178 GLOSS-1047 glos… gloss_LH  Signer_001  NA       
# ℹ 5,672 more rows
# ℹ 5 more variables: ref &lt;chr&gt;, parent_tier &lt;chr&gt;, start &lt;dbl&gt;, end &lt;dbl&gt;,
#   duration &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="combining-elan-tiers-in-wide-format" class="level2">
<h2 class="anchored" data-anchor-id="combining-elan-tiers-in-wide-format">Combining ELAN tiers in wide format</h2>
<p>Sometimes you get the ELAN annotations in a long format, with each row being a single annotation even though some tiers may be child tiers of others, for instance if you read <code>.eaf</code> files using the <code>reaf_eaf()</code> or <code>read_elan()</code> functions. Then, you may want to combine the data into a wide format, such that child tier annotations are on the same rows as their parent tier annotations. This can be achieved with <a href="https://tidyr.tidyverse.org/articles/pivot.html"><strong>pivoting</strong></a>.</p>
<p>We’ll test this with some toy data (NB: not real data!) I have created:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-4_6fcb656ca208f8a2aabf1a3b53acb8f6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>all_annotations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/data/elan_example_data.csv"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_annotations<span class="sc">$</span>tier_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gloss_LH"       "gloss_RH"       "articulator_LH" "articulator_RH"</code></pre>
</div>
</div>
<p>This data frame contains four tier types: <code>"gloss_LH"</code> and <code>"gloss_RH"</code>, which are both parent tiers, used for the sign gloss tiers, and <code>"articulator_LH"</code> and <code>"articulator_RH"</code>, which are both child tiers to the gloss tiers, and contain information about whether the parent annotation is a one- or two-handed sign.</p>
<p>The problem now is that they are all on separate rows, and we cannot immediately link the child annotations to the parent annotations. Luckily, the ELAN format is smart, and has reference annotations that can works as keys to connect the data points! But to do this, we need to subset and re-join the data.</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-5_4b96dd090b5ca010539d65b79ccfe3ed">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can assign the wide data frame to a new variable</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>annotations_wide <span class="ot">&lt;-</span> all_annotations <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We first filter to only parent tiers (they have NA values in the parent_tier)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(parent_tier)) <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We then rejoin with the child tier annotations</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(all_annotations <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Filter to only child tiers</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(parent_tier)) <span class="sc">|&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Select relevant columns only</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(file, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                     parent_tier,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                     a, </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                     ref,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                     annotation,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                     tier,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                     tier_type),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Join by unique identifiers</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(file,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                         tier <span class="sc">==</span> parent_tier,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                         a <span class="sc">==</span> ref))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can compare the lenghts of the two data frames, to see the difference:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(all_annotations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5682</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(annotations_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2841</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(annotations_wide)<span class="sc">*</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5682</code></pre>
</div>
</div>
<p>Since the new wide format data frame is half as long as the original long format one, we can conclude that we each gloss annotation had exactly one articulator annotation, and they matched exactly 1-to-1.</p>
<p>One issue here is that there are multiple columns with the same name being matched, and they have now received additional “tags” at the end, to uniquely identify them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(annotations_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "file"         "a"            "t1"           "t2"           "annotation.x"
 [6] "tier"         "tier_type.x"  "participant"  "annotator"    "ref"         
[11] "parent_tier"  "start"        "end"          "duration"     "a.y"         
[16] "annotation.y" "tier.y"       "tier_type.y" </code></pre>
</div>
</div>
<p>If we want to avoid column names like <code>annotatation.x</code> and <code>annotation.y</code>, we could either rename the columns in the child tier data <em>before</em> joining them with the parent tiers, or we could simply rename them afterwards:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-8_a3eee4cb055c449f7e652a07c0d6871d">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can assign the wide data frame to a new variable</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>annotations_wide <span class="ot">&lt;-</span> all_annotations <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We first filter to only parent tiers (they have NA values in the parent_tier)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(parent_tier)) <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We then rejoin with the child tier annotations</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(all_annotations <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Filter to only child tiers</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(parent_tier)) <span class="sc">|&gt;</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Rename columns before joining</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="st">"a_child"</span> <span class="ot">=</span> a,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tier_child"</span> <span class="ot">=</span> tier,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tier_type_child"</span> <span class="ot">=</span> tier_type,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"annotation_child"</span> <span class="ot">=</span> annotation) <span class="sc">|&gt;</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Select relevant columns only</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(file, </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                     parent_tier,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                     a_child, </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                     ref,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                     annotation_child,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                     tier_child,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                     tier_type_child),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Join by unique identifiers</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(file,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                         tier <span class="sc">==</span> parent_tier,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                         a <span class="sc">==</span> ref))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(annotations_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "file"             "a"                "t1"               "t2"              
 [5] "annotation"       "tier"             "tier_type"        "participant"     
 [9] "annotator"        "ref"              "parent_tier"      "start"           
[13] "end"              "duration"         "a_child"          "annotation_child"
[17] "tier_child"       "tier_type_child" </code></pre>
</div>
</div>
<p>If you are joining multiple child tiers with the same parent tier(s), it is probably best to remove unnecessary columns after joining and/or rename them to something more informative. In this case, for example, we might want the <code>annotation_child</code> column to be called something like <code>num_of_hands</code>, seeing as this is what this tier type referred to: whether a sign is one- or two-handed. Good column names (and variable names in general) help a lot with keeping track of what your data actually is, for example when you want to plot certain variables:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-9_ef24d0a6aa62ecbd2bb41ab0e3f7b48a">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>annotations_wide <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"num_of_hands"</span> <span class="ot">=</span> annotation_child) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>num_of_hands), <span class="at">color=</span><span class="st">"grey30"</span>, <span class="at">fill=</span><span class="st">"dodgerblue"</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">"Tokens"</span>, <span class="at">title=</span><span class="st">"Distribution of one- and two-handed signs"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">15</span>, <span class="at">base_family=</span><span class="st">"Futura"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_for_SL_Linguistics_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="segmenting-turn-taking-in-elan-files" class="level2">
<h2 class="anchored" data-anchor-id="segmenting-turn-taking-in-elan-files">Segmenting “turn-taking” in ELAN files</h2>
<p>ELAN annotation data is represented with a start and end time stamp for each annotation cell. These can be used to order all annotation within a file, or per signer within a file, to represent a chronological order of things. Such orderings can be grouped together to represent utterances or “turns” in conversational data.</p>
<p>I created three different methods for ordering and combining individual annotations into utterances or turns, which can be found here: <a href="https://github.com/borstell/r_functions/blob/main/segment_elan_turns.R"><code>segment_elan_turns</code></a>. Each of the three methods can be sourced as an individual R function. These functions take an ELAN-style data frame as its input, and outputs a data frame where turns have been added: either as an identifier in a new column, or with the annotations collapsed into a one-row-one-utterance format (if using <code>simplify=TRUE</code> in the function call). These functions may help conversation analysis research, and facilitate finding items based on their conversational distribution.</p>
<p>Let’s see an example:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-10_e027648349e6e884a30dc4d532ea37ed">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We read the same toy data as before, but filter to keep only glosses</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>my_glosses <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/data/elan_example_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tier_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"gloss_RH"</span>, <span class="st">"gloss_LH"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>my_glosses</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,841 × 14
   file     a     t1     t2     annotation tier  tier_type participant annotator
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;lgl&gt;    
 1 file_001 a1322 ts579  ts582  GLOSS-0864 glos… gloss_LH  Signer_001  NA       
 2 file_001 a1323 ts585  ts609  GLOSS-0521 glos… gloss_LH  Signer_001  NA       
 3 file_001 a1324 ts669  ts677  GLOSS-0521 glos… gloss_LH  Signer_001  NA       
 4 file_001 a1325 ts681  ts707  GLOSS-0864 glos… gloss_LH  Signer_001  NA       
 5 file_001 a1327 ts741  ts744  GLOSS-1657 glos… gloss_LH  Signer_001  NA       
 6 file_001 a1329 ts1488 ts1496 GLOSS-1656 glos… gloss_LH  Signer_001  NA       
 7 file_001 a1330 ts1567 ts1570 GLOSS-1422 glos… gloss_LH  Signer_001  NA       
 8 file_001 a1333 ts2687 ts2697 GLOSS-0865 glos… gloss_LH  Signer_001  NA       
 9 file_001 a1335 ts3168 ts3170 GLOSS-1046 glos… gloss_LH  Signer_001  NA       
10 file_001 a1336 ts3175 ts3178 GLOSS-1047 glos… gloss_LH  Signer_001  NA       
# ℹ 2,831 more rows
# ℹ 5 more variables: ref &lt;chr&gt;, parent_tier &lt;chr&gt;, start &lt;dbl&gt;, end &lt;dbl&gt;,
#   duration &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(my_glosses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2841</code></pre>
</div>
</div>
<p>With this data, let’s try to simplify it into sequential turns:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-11_97e884ce3d698a53dcc3e13dfae50c63">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/turn_seq.R"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>my_turns <span class="ot">&lt;-</span> <span class="fu">turn_seq</span>(my_glosses, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">file=</span>file, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">start=</span>start, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">end=</span>end, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">participant=</span>participant, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">annotation=</span>annotation, </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="co"># We pivot into collapsed wide turns</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">long =</span> <span class="cn">FALSE</span> <span class="co"># We do not combine overlapping same-producer turns</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>my_turns <span class="sc">|&gt;</span> <span class="fu">select</span>(file, participant, annotations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 266 × 3
   file     participant annotations                                             
   &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;                                                   
 1 file_001 Signer_001  GLOSS-1466 GLOSS-1278 GLOSS-1523 GLOSS-1324 GLOSS-1524 …
 2 file_001 Signer_001  GLOSS-1224                                              
 3 file_001 Signer_001  GLOSS-0418                                              
 4 file_001 Signer_001  GLOSS-1657                                              
 5 file_001 Signer_001  GLOSS-1411                                              
 6 file_001 Signer_001  GLOSS-1569 GLOSS-1279 GLOSS-1656 GLOSS-0418 GLOSS-1452 …
 7 file_001 Signer_001  GLOSS-1657                                              
 8 file_001 Signer_001  GLOSS-0816                                              
 9 file_001 Signer_001  GLOSS-0521 GLOSS-0419 GLOSS-0864 GLOSS-1022 GLOSS-0009 …
10 file_001 Signer_001  GLOSS-1325                                              
# ℹ 256 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(my_turns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 266</code></pre>
</div>
</div>
<p>We can now see that the number of rows has decreased massively, because all the “turns” have been pivoted into single rows, with all individual annotations collapsed into a single string!</p>
<p>This can be useful when looking at turn-taking patterns in data:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-12_15a06c48d6f65596b8702b1a6592d1d4">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>my_turns <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>start<span class="sc">/</span><span class="dv">1000</span>, <span class="at">xend=</span>end<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>participant, <span class="at">yend=</span>participant, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>participant),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth=</span><span class="dv">5</span>, <span class="at">show.legend =</span> F, <span class="at">alpha=</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">""</span>, <span class="at">x=</span><span class="st">"Time (seconds)"</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>file, <span class="at">ncol=</span><span class="dv">1</span>, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_for_SL_Linguistics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The function <code>turn_seq()</code> used here simply merges any uninterrupted sequential annotations belonging to the same participant into the same turn. The other two functions for turn-segmentation are based on either a maximal time interval allowed for sequential annotations (end of one to start of next) – <code>turn_interval()</code> – or an estimation of whose turn it is based on who has the most annotations in the current three-annotation-window in the file – <code>turn_quant()</code>. Since they work differently, they sometimes yield different results when grouping annotations into longer turns.</p>
</section>
<section id="splitting-videos-based-on-elan-annotation" class="level2">
<h2 class="anchored" data-anchor-id="splitting-videos-based-on-elan-annotation">Splitting videos based on ELAN annotation</h2>
<p>In some use cases, a researcher may have ELAN files with annotations of individual signs being produced and each having been annotated in ELAN: for example, when collecting lexical items for a dictionary project. I wrote a basic function that can segment the video into shorter video clips based on the position of each ELAN annotation in the <code>.eaf</code> files. This function requires <a href="https://ffmpeg.org/"><code>FFmpeg</code></a> installed, as it runs <code>ffmpeg</code> commands behind the scenes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Source the R script to load the functions into the session</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/split_elan_videos.R"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of use</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">split_elan_video</span>(<span class="at">elan_path =</span> <span class="st">"/path/to/eaf/file(s)"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segmentation_tier =</span> <span class="st">"name_of_segmentation_tier"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">video_path =</span> <span class="st">"/path/to/video/file(s)"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">annotation_tag =</span> T, <span class="co"># will add contents of ELAN cells in output filenames</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">padding =</span> <span class="dv">0</span>, <span class="co"># adds (or subtracts if negative) frames (in milliseconds) before+after segment duration</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">video_input_format =</span> <span class="st">".mov"</span>, <span class="co"># specify input video format in directory (default is .mp4)</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">video_output_format =</span> <span class="st">".mp4"</span>) <span class="co"># specify output video format (default is .mp4)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="further-possibilities" class="level2">
<h2 class="anchored" data-anchor-id="further-possibilities">Further possibilities</h2>
<p>There is other ELAN functionality available through the <a href="https://github.com/borstell/signglossR/"><code>{signglossR}</code></a> package.</p>
</section>
</section>
<section id="plotting-handshape-fonts" class="level1">
<h1>Plotting handshape fonts</h1>
<p>Sometimes, especially when working on phonological data, it is useful to illustrate handshapes as visual forms rather than resort to language-specific labels (e.g.&nbsp;“baby-C”). One possibility is to use the handshape fonts created by <a href="http://www.cslds.org/v4/resources.php?id=1">CSLDS, CUHK</a>. Downloading the main handshape font, you can install it on your computer, where it should be available as a local font with the name <code>handshape2002</code>. In principle, any font available on your local computer should also be available for plotting with <a href="http://ggplot2.tidyverse.org/"><code>{ggplot2}</code></a>.</p>
<p>Let’s first read some – once again – toy data. This data file gives the example of 1000 data points, each describing a handshape using labels referring to the ASL manual alphabet. This could, for instance, be the annotations from an ELAN file, where annotators have annotated each of 1000 signs in a text/dictionary/etc with a single label representing the handshape.</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-14_53810b79a01e27ffa59dc46c0a61870d">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>handshapes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/borstell/r_functions/main/data/handshape_example_data.csv"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>handshapes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 1
   hs   
   &lt;chr&gt;
 1 A    
 2 O    
 3 B    
 4 O    
 5 1    
 6 1    
 7 S    
 8 1    
 9 A    
10 1    
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>We may want to plot this data, to see the distribution of handshapes:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-15_45d8740707761b4a5d59e161eaf970a3">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>handshapes <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>hs), <span class="at">color=</span><span class="st">"grey30"</span>, <span class="at">fill=</span><span class="st">"dodgerblue"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">"Tokens"</span>, <span class="at">title=</span><span class="st">"Distribution of handshapes"</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">15</span>, <span class="at">base_family=</span><span class="st">"Futura"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_for_SL_Linguistics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So, this plot is quite OK looking, but I would personally prefer it if we could change two things (and perhaps a third as a bonus):</p>
<ol type="1">
<li>Reorder the bars to reflect their frequency</li>
<li>Use a more visual label for the handshapes (e.g.&nbsp;<em>actual</em> handshapes)</li>
<li>Bonus: we may also be more interested in the <em>percentages</em> rather than absolute totals.</li>
</ol>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-16_2cccf27bfd305b086fa6d995001b4b14">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We add the package `{scales}` to get the percent format</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>handshapes <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hs) <span class="sc">|&gt;</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate proportion of n of total ns</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(hs, <span class="sc">-</span>n), <span class="at">y=</span>percent), <span class="at">color=</span><span class="st">"grey30"</span>, <span class="at">fill=</span><span class="st">"dodgerblue"</span>) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">title=</span><span class="st">"Distribution of handshapes"</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">15</span>, <span class="at">base_family=</span><span class="st">"Futura"</span>) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="fu">rel</span>(<span class="dv">3</span>), <span class="at">family=</span><span class="st">"handshape2002"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_for_SL_Linguistics_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Oops! This is not what we wanted! Oh, right, the handshape labels “B”, “O”, etc are not equivalent to the intended handshapes in the <code>handshape2002</code> font. So we will need to create a conversion table for our labels. The below is a manually created conversion table between the handshapes.</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-17_9ac7812b508d92656c816821a89b6115">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>hs_conversion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"1"</span>, <span class="st">"6"</span>, <span class="st">"&lt;"</span>, <span class="st">"A"</span>, <span class="st">"&gt;"</span>, <span class="st">"B"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hs_conversion) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"S"</span>, <span class="st">"C"</span>, <span class="st">"O"</span>, <span class="st">"5"</span>, <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try again, but changing the <code>x</code> mapping to the include the handshape to font conversion:</p>
<div class="cell" data-hash="R_for_SL_Linguistics_cache/html/unnamed-chunk-18_a646a89f9d8fe69bb93879921768aff1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We add the package `{scales}` to get the percent format</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>handshapes <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hs) <span class="sc">|&gt;</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate proportion of n of total ns</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(hs_conversion[hs], <span class="sc">-</span>n), <span class="at">y=</span>percent), <span class="at">color=</span><span class="st">"grey30"</span>, <span class="at">fill=</span><span class="st">"dodgerblue"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">title=</span><span class="st">"Distribution of handshapes"</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">15</span>, <span class="at">base_family=</span><span class="st">"Futura"</span>) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="fu">rel</span>(<span class="dv">3</span>), <span class="at">family=</span><span class="st">"handshape2002"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_for_SL_Linguistics_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This looks nicer! And a whole lot more informative than opaque and language-specific handshape labels, in my opinion!</p>
</section>
<section id="working-with-imagevideo-data" class="level1">
<h1>Working with image/video data</h1>
<p>There is plenty of functionality in the <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html"><code>{magick}</code></a> package for image processing. There is some functionality for video processing with the <a href="https://cran.r-project.org/web/packages/av/index.html"><code>{av}</code></a> package. The <a href="https://github.com/borstell/signglossR/"><code>{signglossR}</code></a> package relies heavily on these packages for the image and video processing. I refer to these three packages and their respective documentation for further information about functionality and use.</p>
</section>
<section id="license" class="level1">
<h1>License</h1>
<p>This tutorial is published under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode">CC BY-NC-SA 4.0 license</a>.</p>
<p><img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" class="img-fluid"></p>
<p>Feel free to share or reuse the content for your own research or teaching.</p>
<p><em>“I don’t have a SoundCloud”</em>, but if you enjoyed this tutorial:</p>
<ul>
<li>if you have the means, <strong>donate</strong> to a charity or someone in need,</li>
<li><strong>give praise</strong> to others for their work and actions,</li>
<li><strong>support</strong> your peers and students,</li>
<li><strong>be an ally</strong>, and</li>
<li>work towards a <strong>kinder academia</strong>.</li>
</ul>
</section>
<section id="citation" class="level1">
<h1>Citation</h1>
<p>If you want to cite this tutorial, here’s a suggested bibtex format:</p>
<pre><code>@manual{r4sl,
  author = {Börstell, Carl},
  title = {R for Sign Language Linguistics},
  year = {2023},
  url = {https://borstell.github.io/misc/r4sl},
}</code></pre>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>